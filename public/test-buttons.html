<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Buttons - WA Blast</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>ðŸ§ª Button Test Page</h2>
        <p>This page shows all connection buttons to verify they're working correctly.</p>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Connection Buttons Test</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button id="connectBtn" class="btn btn-success">
                                <i class="fas fa-plug me-2"></i>
                                Connect WhatsApp
                            </button>
                            <button id="newConnectionBtn" class="btn btn-warning">
                                <i class="fas fa-qrcode me-2"></i>
                                New QR Code (Fresh Session)
                            </button>
                            <button id="disconnectBtn" class="btn btn-danger">
                                <i class="fas fa-unlink me-2"></i>
                                Disconnect
                            </button>
                        </div>
                        
                        <hr>
                        
                        <div class="mt-3">
                            <h6>Button States:</h6>
                            <div class="btn-group-vertical w-100" role="group">
                                <button class="btn btn-outline-secondary" onclick="showDisconnected()">
                                    Show Disconnected State
                                </button>
                                <button class="btn btn-outline-secondary" onclick="showConnecting()">
                                    Show Connecting State
                                </button>
                                <button class="btn btn-outline-secondary" onclick="showQRReady()">
                                    Show QR Ready State
                                </button>
                                <button class="btn btn-outline-secondary" onclick="showConnected()">
                                    Show Connected State
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <div id="statusDisplay" class="alert alert-info">
                                Current State: <span id="currentState">Disconnected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Button Actions Test</h5>
                    </div>
                    <div class="card-body">
                        <div id="actionLog" class="border p-3" style="height: 300px; overflow-y: auto;">
                            <p><strong>Action Log:</strong></p>
                        </div>
                        <button class="btn btn-sm btn-secondary mt-2" onclick="clearLog()">
                            Clear Log
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-3">
            <a href="/" class="btn btn-primary">
                <i class="fas fa-arrow-left me-2"></i>
                Back to Main Page
            </a>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // Get button elements
        const connectBtn = document.getElementById('connectBtn');
        const newConnectionBtn = document.getElementById('newConnectionBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const currentState = document.getElementById('currentState');
        const actionLog = document.getElementById('actionLog');
        
        // Add event listeners
        connectBtn.addEventListener('click', () => {
            logAction('Connect WhatsApp clicked');
            socket.emit('connect-whatsapp');
        });
        
        newConnectionBtn.addEventListener('click', () => {
            logAction('New QR Code clicked');
            if (confirm('Generate new QR code with fresh session?')) {
                socket.emit('force-new-connection');
            }
        });
        
        disconnectBtn.addEventListener('click', () => {
            logAction('Disconnect clicked');
            socket.emit('disconnect-whatsapp');
        });
        
        // Socket listeners
        socket.on('whatsapp-status', (status) => {
            logAction(`Status update: ${status.status}, Connected: ${status.isConnected}`);
            updateButtonState(status);
        });
        
        // Button state functions
        function showDisconnected() {
            updateButtonState({ isConnected: false, status: 'disconnected' });
            currentState.textContent = 'Disconnected';
        }
        
        function showConnecting() {
            updateButtonState({ isConnected: false, status: 'connecting' });
            currentState.textContent = 'Connecting';
        }
        
        function showQRReady() {
            updateButtonState({ isConnected: false, status: 'qr-ready', qrCode: 'test' });
            currentState.textContent = 'QR Ready';
        }
        
        function showConnected() {
            updateButtonState({ isConnected: true, status: 'connected' });
            currentState.textContent = 'Connected';
        }
        
        function updateButtonState(status) {
            if (status.isConnected) {
                // Connected state
                connectBtn.style.display = 'none';
                newConnectionBtn.style.display = 'block';
                disconnectBtn.style.display = 'block';
            } else if (status.status === 'connecting') {
                // Connecting state
                connectBtn.style.display = 'none';
                newConnectionBtn.style.display = 'none';
                disconnectBtn.style.display = 'block';
            } else if (status.status === 'qr-ready' && status.qrCode) {
                // QR Ready state
                connectBtn.style.display = 'none';
                newConnectionBtn.style.display = 'block';
                disconnectBtn.style.display = 'block';
            } else {
                // Disconnected state
                connectBtn.style.display = 'block';
                newConnectionBtn.style.display = 'block';
                disconnectBtn.style.display = 'none';
            }
        }
        
        function logAction(message) {
            const time = new Date().toLocaleTimeString();
            actionLog.innerHTML += `<div><small class="text-muted">${time}</small> - ${message}</div>`;
            actionLog.scrollTop = actionLog.scrollHeight;
        }
        
        function clearLog() {
            actionLog.innerHTML = '<p><strong>Action Log:</strong></p>';
        }
        
        // Initialize with disconnected state
        showDisconnected();
        logAction('Test page loaded');
    </script>
</body>
</html>
